<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculateur de baies non protégées (CNB)</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background-color: #f9f9f9; }
        #app { max-width: 800px; margin: 0 auto; padding: 20px; background-color: white; border-radius: 8px; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); }
        h1 { color: #333; text-align: center; }
        .tab-nav { overflow: hidden; background-color: #f1f1f1; border-bottom: 1px solid #ccc; }
        .tab-nav button { background-color: inherit; float: left; border: none; outline: none; cursor: pointer; padding: 14px 16px; transition: 0.3s; font-size: 16px; }
        .tab-nav button:hover { background-color: #ddd; }
        .tab-nav button.active { background-color: #004d99; color: white; }
        .tab-content { display: none; padding: 20px; border: 1px solid #ccc; border-top: none; }
        .tab-content.active { display: block; }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin: 10px 0; font-size: 16px; }
        input[type="number"], textarea, select { width: 100%; padding: 8px; margin-top: 5px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; }
        textarea { resize: vertical; }
        button { margin: 10px 0; padding: 10px 20px; background-color: #007BFF; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 16px; }
        button:hover { background-color: #0056b3; }
        .results { background-color: #f1f1f1; padding: 20px; border-radius: 8px; margin-top: 20px; }
    </style>
</head>
<body>
    <div id="app">
        <h1>Calculateur de baies non protégées (CNB)</h1>
        <div class="tab-nav">
            <button class="tab-link active" onclick="openTab('cnb')">Méthode CNB</button>
            <button class="tab-link" onclick="openTab('method91014')">Méthode 9.10.14</button>
            <button class="tab-link" onclick="openTab('method91015')">Méthode 9.10.15</button>
        </div>

        <!-- Onglet Méthode CNB -->
        <div id="cnb" class="tab-content active">
            <p>Calcul basé sur la section 3.2.3 du CNB (Tableau 3.2.3.1-B)</p>
            <div class="form-group">
                <label for="usage_cnb">Usage du bâtiment</label>
                <select id="usage_cnb">
                    <option value="habitation">Habitation (Groupe C)</option>
                    <option value="affaires">Affaires (Groupe A, B, D, F3)</option>
                </select>
            </div>
            <div class="form-group">
                <label><input type="checkbox" id="sprinklers_cnb"> Bâtiment entièrement protégé par gicleurs</label>
            </div>
            <div class="form-group">
                <label for="distance_cnb">Distance limitative (m)</label>
                <input type="number" id="distance_cnb" value="5" min="0">
            </div>
            <div class="form-group">
                <label for="surface_cnb">Surface de la façade de rayonnement (m²)</label>
                <input type="number" id="surface_cnb" value="120" min="0">
            </div>
            <div class="form-group">
                <label for="length_cnb">Longueur de la façade (m)</label>
                <input type="number" id="length_cnb" value="20" min="0">
            </div>
            <div class="form-group">
                <label for="height_cnb">Hauteur de la façade (m)</label>
                <input type="number" id="height_cnb" value="6" min="0">
            </div>
            <div class="form-group">
                <label><input type="checkbox" id="response_cnb"> Plus de 10 min dans 10 % ou plus des cas</label>
            </div>
            <button onclick="calculateCNB()">Calculer</button>
            <p id="cnb-result" class="results"></p>
        </div>

        <!-- Onglet Méthode 9.10.14 -->
        <div id="method91014" class="tab-content">
            <p>Calcul basé sur la méthode 9.10.14 du CNB (Tableau 9.10.14.4-A)</p>
            <div class="form-group">
                <label for="usage_91014">Usage du bâtiment</label>
                <select id="usage_91014">
                    <option value="habitation">Habitation</option>
                    <option value="commercial">Commercial/Industriel</option>
                </select>
            </div>
            <div class="form-group">
                <label for="distance_91014">Distance limitative (m)</label>
                <input type="number" id="distance_91014" value="1.2" min="0">
            </div>
            <div class="form-group">
                <label for="surface_91014">Surface de la façade de rayonnement (m²)</label>
                <input type="number" id="surface_91014" value="30" min="0">
            </div>
            <button onclick="calculate91014()">Calculer</button>
            <p id="method91014-result" class="results"></p>
        </div>

        <!-- Onglet Méthode 9.10.15 -->
        <div id="method91015" class="tab-content">
            <p>Calcul basé sur la méthode 9.10.15 du CNB (Tableau 9.10.15.4)</p>
            <div class="form-group">
                <label><input type="checkbox" id="sprinklers_91015"> Gicleurs</label>
            </div>
            <div class="form-group">
                <label for="surface_91015">Surface de la façade de rayonnement (m²)</label>
                <input type="number" id="surface_91015" value="50" min="0">
            </div>
            <div class="form-group">
                <label for="distance_91015">Distance limitative (m)</label>
                <input type="number" id="distance_91015" value="2" min="0">
            </div>
            <div class="form-group">
                <label for="openings_91015">Baies vitrées (JSON : [{"area": m², "x": m, "y": m}, ...])</label>
                <textarea id="openings_91015" rows="3">[{"area": 0.3, "x": 1, "y": 1}, {"area": 0.3, "x": 4, "y": 1}]</textarea>
            </div>
            <div class="form-group">
                <label><input type="checkbox" id="singleRoom_91015"> Desservent une seule pièce</label>
            </div>
            <div class="form-group">
                <label for="wallHeight_91015">Hauteur des murs de séparation (m)</label>
                <input type="number" id="wallHeight_91015" value="1.5" min="0">
            </div>
            <button onclick="calculate91015()">Calculer</button>
            <p id="method91015-result" class="results"></p>
        </div>
    </div>

    <script>
        // Données du Tableau 3.2.3.1.-B (Surface maximale des baies non protégées en %)
        const unprotectedOpeningsTable = {
            10: {
                "< 3:1": [0, 8, 10, 18, 29, 46, 91, 100],
                "3:1 à 10:1": [0, 8, 12, 21, 33, 50, 96, 100],
                "> 10:1": [0, 11, 16, 32, 48, 68, 100, 100],
            },
            15: {
                "< 3:1": [0, 7, 9, 14, 22, 33, 63, 100],
                "3:1 à 10:1": [0, 8, 10, 15, 21, 30, 55, 100],
                "> 10:1": [0, 9, 14, 23, 33, 45, 73, 100],
            },
            20: {
                "< 3:1": [0, 7, 9, 12, 18, 26, 48, 81, 100],
                "3:1 à 10:1": [0, 8, 10, 15, 21, 30, 55, 85, 100],
                "> 10:1": [0, 9, 14, 23, 33, 45, 73, 100],
            },
            25: {
                "< 3:1": [0, 7, 8, 11, 16, 23, 41, 66, 98, 100],
                "3:1 à 10:1": [0, 8, 9, 13, 19, 26, 45, 70, 100],
                "> 10:1": [0, 9, 14, 21, 30, 39, 62, 90, 100],
            },
            30: {
                "< 3:1": [0, 7, 8, 11, 15, 20, 32, 56, 83, 100],
                "3:1 à 10:1": [0, 7, 9, 12, 17, 23, 39, 61, 88, 100],
                "> 10:1": [0, 8, 12, 19, 27, 38, 56, 79, 100],
            },
            40: {
                "< 3:1": [0, 7, 8, 10, 13, 17, 28, 44, 64, 89, 100],
                "3:1 à 10:1": [0, 7, 8, 11, 15, 20, 32, 48, 69, 93, 100],
                "> 10:1": [0, 8, 11, 17, 24, 31, 47, 66, 83, 100],
            },
            50: {
                "< 3:1": [0, 7, 8, 10, 14, 18, 28, 41, 57, 77, 100],
                "3:1 à 10:1": [0, 7, 8, 11, 15, 20, 32, 47, 66, 87, 100],
                "> 10:1": [0, 8, 11, 17, 24, 31, 47, 66, 83, 100],
            },
            60: {
                "< 3:1": [0, 7, 8, 9, 11, 14, 21, 32, 45, 62, 81, 100],
                "3:1 à 10:1": [0, 7, 8, 10, 13, 16, 25, 36, 49, 66, 85, 100],
                "> 10:1": [0, 8, 10, 14, 20, 25, 38, 51, 67, 85, 100],
            },
            80: {
                "< 3:1": [0, 7, 7, 8, 10, 12, 18, 26, 36, 48, 62, 79, 98, 100],
                "3:1 à 10:1": [0, 7, 8, 9, 11, 14, 20, 29, 40, 52, 67, 84, 100],
                "> 10:1": [0, 8, 9, 13, 17, 22, 29, 39, 50, 62, 76, 89, 100],
            },
            100: {
                "< 3:1": [0, 7, 7, 8, 9, 11, 16, 22, 30, 40, 51, 65, 80, 97, 100],
                "3:1 à 10:1": [0, 7, 8, 9, 11, 13, 18, 25, 34, 44, 56, 69, 84, 100],
                "> 10:1": [0, 7, 9, 12, 16, 20, 29, 39, 48, 61, 74, 89, 100],
            },
            150: {
                "< 3:1": [0, 7, 7, 8, 9, 10, 13, 17, 22, 29, 37, 46, 56, 67, 79, 93, 100],
                "3:1 à 10:1": [0, 7, 7, 8, 10, 11, 15, 20, 26, 33, 41, 50, 60, 71, 84, 97, 100],
                "> 10:1": [0, 7, 8, 11, 13, 17, 24, 31, 39, 48, 57, 68, 79, 91, 100],
            },
            250: {
                "< 3:1": [0, 7, 7, 7, 8, 9, 10, 13, 16, 20, 25, 30, 36, 43, 51, 59, 68, 87, 100],
                "3:1 à 10:1": [0, 7, 7, 8, 9, 10, 12, 15, 19, 24, 28, 34, 40, 47, 55, 63, 72, 92, 100],
                "> 10:1": [0, 7, 8, 9, 11, 14, 19, 24, 30, 36, 43, 50, 58, 66, 73, 82, 92, 100],
            },
            350: {
                "< 3:1": [0, 7, 7, 7, 8, 8, 9, 11, 14, 16, 20, 24, 27, 32, 37, 42, 48, 64, 81, 99, 100],
                "3:1 à 10:1": [0, 7, 7, 8, 8, 9, 11, 13, 16, 20, 23, 27, 31, 36, 41, 46, 52, 69, 85, 100],
                "> 10:1": [0, 7, 8, 9, 10, 12, 15, 19, 23, 27, 32, 37, 42, 47, 52, 58, 64, 81, 90, 100],
            },
            500: {
                "< 3:1": [0, 7, 7, 7, 7, 8, 9, 10, 12, 14, 16, 19, 22, 25, 29, 33, 37, 47, 58, 71, 100],
                "3:1 à 10:1": [0, 7, 7, 7, 8, 9, 10, 12, 14, 16, 19, 22, 25, 29, 33, 37, 41, 52, 63, 76, 100],
                "> 10:1": [0, 7, 8, 8, 9, 11, 14, 18, 22, 25, 30, 34, 38, 43, 48, 53, 58, 70, 82, 96, 100],
            },
            1000: {
                "< 3:1": [0, 7, 7, 7, 7, 8, 9, 9, 10, 12, 13, 14, 16, 18, 20, 22, 27, 33, 39, 58, 82, 100],
                "3:1 à 10:1": [0, 7, 7, 7, 8, 8, 9, 10, 11, 12, 14, 15, 17, 19, 21, 23, 26, 31, 37, 43, 63, 86, 100],
                "> 10:1": [0, 7, 7, 8, 9, 10, 11, 13, 15, 17, 19, 21, 23, 25, 27, 29, 31, 36, 41, 46, 60, 82, 100],
            },
            2000: {
                "< 3:1": [0, 7, 7, 7, 7, 7, 8, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 20, 23, 27, 37, 49, 63, 79, 97, 100],
                "3:1 à 10:1": [0, 7, 7, 7, 7, 8, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 20, 23, 27, 36, 46, 60, 77, 93, 100],
                "> 10:1": [0, 7, 7, 8, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 21, 23, 25, 27, 32, 36, 40, 53, 66, 82, 99, 100],
            },
        };

        const limitingDistances = [0, 1.2, 1.5, 2.0, 2.5, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 16, 18, 20, 25, 30, 35, 40, 45, 50];
        const facadeSurfaces = [10, 15, 20, 25, 30, 40, 50, 60, 80, 100, 150, 250, 350, 500, 1000, 2000];

        function getRatioCategory(length, height) {
            const ratioLH = length / height;
            const ratioHL = height / length;
            const maxRatio = Math.max(ratioLH, ratioHL);
            if (maxRatio < 3) return "< 3:1";
            if (maxRatio <= 10) return "3:1 à 10:1";
            return "> 10:1";
        }

        function findClosest(value, array) {
            return array.reduce((prev, curr) => Math.abs(curr - value) < Math.abs(prev - value) ? curr : prev);
        }

        function calculateCNB() {
            const facadeSurface = parseFloat(document.getElementById('surface_cnb').value);
            const length = parseFloat(document.getElementById('length_cnb').value);
            const height = parseFloat(document.getElementById('height_cnb').value);
            const limitingDistance = parseFloat(document.getElementById('distance_cnb').value);
            const sprinklers = document.getElementById('sprinklers_cnb').checked;
            const response = document.getElementById('response_cnb').checked;

            if (isNaN(facadeSurface) || isNaN(length) || isNaN(height) || isNaN(limitingDistance)) {
                document.getElementById('cnb-result').innerText = "Erreur : Veuillez entrer des valeurs numériques valides.";
                return;
            }

            const closestSurface = findClosest(facadeSurface, facadeSurfaces);
            const closestDistance = findClosest(limitingDistance, limitingDistances);
            const ratioCategory = getRatioCategory(length, height);
            const distanceIndex = limitingDistances.indexOf(closestDistance);
            let maxPercentage = unprotectedOpeningsTable[closestSurface][ratioCategory][distanceIndex];

            if (sprinklers) maxPercentage = Math.min(maxPercentage * 2, 100);
            if (response) maxPercentage *= 0.8;

            document.getElementById('cnb-result').innerText = `Surface maximale des baies non protégées : ${maxPercentage.toFixed(2)}%`;
        }

        // Données du Tableau 9.10.14.4-A
        const tableau91014 = {
            "habitation": {
                distances: [0, 1.2, 1.5, 2.0, 2.5, 3, 4, 5, 6, 7, 8, 9, 10],
                percentages: [0, 10, 15, 20, 25, 30, 40, 50, 60, 70, 80, 90, 100]
            },
            "commercial": {
                distances: [0, 1.2, 1.5, 2.0, 2.5, 3, 4, 5, 6, 7, 8, 9, 10],
                percentages: [0, 5, 10, 15, 20, 25, 30, 35, 40, 45, 50, 55, 60]
            }
        };

        function calculate91014() {
            const usage = document.getElementById('usage_91014').value;
            const distance = parseFloat(document.getElementById('distance_91014').value);
            const surface = parseFloat(document.getElementById('surface_91014').value);

            if (isNaN(distance) || isNaN(surface)) {
                document.getElementById('method91014-result').innerText = "Erreur : Veuillez entrer des valeurs numériques valides.";
                return;
            }

            const distances = tableau91014[usage].distances;
            const percentages = tableau91014[usage].percentages;
            const closestDistance = findClosest(distance, distances);
            const index = distances.indexOf(closestDistance);
            const maxPercentage = percentages[index];
            const maxArea = (maxPercentage / 100) * surface;

            document.getElementById('method91014-result').innerText = `Pourcentage maximal : ${maxPercentage}%\nSurface maximale des baies non protégées : ${maxArea.toFixed(2)} m²`;
        }

        // Données du Tableau 9.10.15.4
        const glazedOpeningsTable = {
            30: [0, 7, 9, 12, 39, 88, 100],
            40: [0, 7, 8, 11, 32, 69, 100],
            50: [0, 7, 8, 10, 28, 57, 100],
            100: [0, 7, 8, 9, 18, 34, 56, 84, 100],
            "Plus de 100": [0, 7, 7, 8, 12, 19, 28, 40, 55, 92, 100],
        };

        const limitingDistancesHouses = [0, 1.2, 1.5, 2.0, 4.0, 6.0, 8.0, 10.0, 12.0, 16.0, 20.0];

        function findClosestFacadeSurfaceHouses(surface) {
            if (surface > 100) return "Plus de 100";
            const surfaces = [30, 40, 50, 100];
            return findClosest(surface, surfaces);
        }

        function calculate91015() {
            const facadeSurface = parseFloat(document.getElementById('surface_91015').value);
            const limitingDistance = parseFloat(document.getElementById('distance_91015').value);
            const hasSprinklers = document.getElementById('sprinklers_91015').checked;
            const openingsInput = document.getElementById('openings_91015').value;
            const servesSingleSpace = document.getElementById('singleRoom_91015').checked;
            const wallHeight = parseFloat(document.getElementById('wallHeight_91015').value);

            if (isNaN(facadeSurface) || isNaN(limitingDistance) || isNaN(wallHeight)) {
                document.getElementById('method91015-result').innerText = "Erreur : Veuillez entrer des valeurs numériques valides.";
                return;
            }

            let openings;
            try {
                openings = JSON.parse(openingsInput);
                if (!Array.isArray(openings)) throw new Error("Les baies vitrées doivent être un tableau JSON.");
            } catch (e) {
                document.getElementById('method91015-result').innerText = "Erreur : Format JSON invalide pour les baies vitrées.";
                return;
            }

            const closestSurface = findClosestFacadeSurfaceHouses(facadeSurface);
            const closestDistance = findClosest(limitingDistance, limitingDistancesHouses);
            const distanceIndex = limitingDistancesHouses.indexOf(closestDistance);
            let percentage = glazedOpeningsTable[closestSurface][distanceIndex];

            if (!hasSprinklers && limitingDistance <= 2) percentage = Math.min(percentage, 50);
            const maxArea = (percentage / 100) * facadeSurface;
            const totalArea = openings.reduce((sum, opening) => sum + opening.area, 0);

            let result = `Surface maximale des baies vitrées : ${percentage.toFixed(2)}%\nSurface totale autorisée : ${maxArea.toFixed(2)} m²\nSurface totale des baies : ${totalArea.toFixed(2)} m²`;

            // Vérifications de conformité (Article 9.10.15.4)
            let isCompliant = totalArea <= maxArea;
            if (isCompliant && openings.length > 1) {
                for (let i = 0; i < openings.length - 1; i++) {
                    for (let j = i + 1; j < openings.length; j++) {
                        const dx = Math.abs(openings[i].x - openings[j].x);
                        const dy = Math.abs(openings[i].y - openings[j].y);
                        if (dx < 1.2 && dy < 1.2) {
                            isCompliant = false;
                            result += "\nNon conforme : Espacement des baies < 1,2 m.";
                            break;
                        }
                    }
                    if (!isCompliant) break;
                }
                if (isCompliant && wallHeight < 0.9) {
                    isCompliant = false;
                    result += "\nNon conforme : Hauteur des murs de séparation < 0,9 m.";
                }
            }

            if (isCompliant) result += "\nConforme.";
            document.getElementById('method91015-result').innerText = result;
        }

        function openTab(tabName) {
            var i, tabcontent, tablinks;
            tabcontent = document.getElementsByClassName("tab-content");
            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].classList.remove("active");
            }
            tablinks = document.getElementsByClassName("tab-link");
            for (i = 0; i < tablinks.length; i++) {
                tablinks[i].classList.remove("active");
            }
            document.getElementById(tabName).classList.add("active");
            event.currentTarget.classList.add("active");
        }
    </script>
</body>
</html>
